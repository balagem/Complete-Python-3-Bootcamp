import yfinance as yf
import pandas as pd

def get_annual_dividends(ticker_symbol):
    try:
        stock = yf.Ticker(ticker_symbol)
        dividends = stock.dividends
        annual_dividends = dividends.resample('Y').sum()  # Resample to annual frequency and sum
        return annual_dividends
    except Exception as e:
        print(f"Error fetching dividends for {ticker_symbol}: {e}")
        return None

def main():
    # Get a list of ticker symbols from the user
    symbols = input("Enter ticker symbols (comma-separated): ").split(',')

    # Create a Pandas DataFrame to store the annual dividend data
    annual_dividend_data = pd.DataFrame()

    # Fetch annual dividends for each ticker symbol
    for symbol in symbols:
        symbol = symbol.strip().upper()  # Ensure symbols are in uppercase
        annual_dividends = get_annual_dividends(symbol)

        if annual_dividends is not None:
            annual_dividend_data[symbol] = annual_dividends

    # Convert datetime index to a timezone-unaware format
    annual_dividend_data.index = annual_dividend_data.index.tz_localize(None)

    # Save the annual dividend data to an Excel file
    excel_file = 'annual_dividend_data.xlsx'
    annual_dividend_data.to_excel(excel_file, index_label='Date')

    print(f"Annual dividend data saved to {excel_file}")

if __name__ == "__main__":
    main()
